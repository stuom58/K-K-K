<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>فرم ثبت</title>
  <link rel="stylesheet" href="./footer-style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <link rel="stylesheet" href=" ./form_email.css">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div id="navbar-container"></div>

  <h1>فرم سفارش خرید درخواست مشاوره فنی </h1>
  <form id="contact-form" enctype="multipart/form-data">
    <!-- بخش اول -->
    <fieldset>
      <legend>اطلاعات شخصی</legend>
      <div class="input_g_p1">
        <div class="input-group">
          <label for="firstName">نام:</label>
          <input type="text" name="firstName" id="firstName" class="short" required>
        </div>
        <div class="input-group">
          <label for="lastName">نام خانوادگی:</label>
          <input type="text" name="lastName" id="lastName" class="short" required>
        </div>
      </div>
      <div class="input_g_p1">
        <div class="input-group">
          <label for="company">شرکت:</label>
          <input type="text" name="company" id="company" class="short" required>
        </div>
        <div class="input-group">
          <label for="position">سمت در شرکت:</label>
          <input type="text" name="position" id="position" class="short" required>
        </div>
      </div>
      <div class="input_g_p1">
        <div class="input-group">
          <label for="mobile">شماره موبایل:</label>
          <input type="text" name="mobile" id="mobile" class="short" required>
        </div>
        <div class="input-group">
          <label for="phone">شماره تلفن:</label>
          <input type="text" name="phone" id="phone" class="short" required>
        </div>
      </div>
    </fieldset>
    <br>
    <!-- بخش دوم -->
    <fieldset>
      <legend>اطلاعات قطعه معیوب</legend>
      <div class="input_g_p1">
        <div class="input-group">
          <label for="partName">نام قطعه معیوب:</label>
          <input type="text" name="partName" id="partName" class="short" required>
        </div>
        <div class="input-group">
          <label for="partSerial">شماره سریال قطعه معیوب:</label>
          <input type="text" name="partSerial" id="partSerial" class="short" required>
        </div>
      </div>
      <div class="input_g_p1">
        <div class="input-group">
          <label for="machineName">نام دستگاه یا ماشین صنعتی:</label>
          <input type="text" name="machineName" id="machineName" class="short" required>
        </div>
        <div class="input-group">
          <label for="machineSerial">شماره سریال دستگاه یا ماشین صنعتی:</label>
          <input type="text" name="machineSerial" id="machineSerial" class="short" required>
        </div>
      </div>
      <div class="full-width-group">
        <label for="faultReason">دلیل خرابی:</label>
        <input type="text" name="faultReason" id="faultReason" class="short full-width" required>
      </div>
      <div class="full-width-group">
        <label for="faultStatus">وضعیت علایم دستگاه در حالت خرابی:</label>
        <input type="text" name="faultStatus" id="faultStatus" required>
      </div>
      <div class="full-width-group">
        <label for="description">توضیحات:</label>
        <textarea name="description" id="description" required></textarea>
      </div>
      <!-- لینک‌های ارسال ایمیل و تلگرام -->
      <div class="full-width-group">
        <label class="label_send_img">ارسال عکسهای دستگاه و قطعه معیوب از طریق:</label>
        <div class="social-links">
          <a href="https://mail.google.com/mail/?view=cm&fs=1&to=nasri@gmail.com&su=ارسال عکس فرم&body=لطفاً عکسها و اطلاعات خود را ارسال کنید." class="social-link" target="_blank">
            <img src="/email1.png" alt="ارسال ایمیل">
             ایمیل
          </a>
          <a href="https://t.me/yourusername" class="social-link" target="_blank">
            <img src="/telegram_2504941.svg" alt="تلگرام">
             تلگرام
          </a>
        </div>
      </div>
      <div class="button-container">
        <button type="submit">ارسال</button>
      </div>
    </fieldset>
  </form>

  <div id="footer-container"></div>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@latest/dist/email.min.js"></script>
  <script type="text/javascript">
    // تابع تولید کد یکتا
    function generateUniqueCode() {
      const now = new Date(); // دریافت تاریخ و زمان فعلی

      // استخراج بخش‌های مختلف تاریخ و زمان
      const year = now.getFullYear().toString().slice(-2); // دو رقم آخر سال (مثلاً 25 برای 2025)
      const month = String(now.getMonth() + 1).padStart(2, '0'); // ماه (دو رقم)
      const day = String(now.getDate()).padStart(2, '0'); // روز (دو رقم)
      const hours = String(now.getHours()).padStart(2, '0'); // ساعت (دو رقم، 24 ساعته)
      const minutes = String(now.getMinutes()).padStart(2, '0'); // دقیقه (دو رقم)
      const seconds = String(now.getSeconds()).padStart(2, '0'); // ثانیه (دو رقم)

      // ترکیب بخش‌ها به فرمت مورد نظر
      const uniqueCode = `${year}${month}${day}${hours}${minutes}${seconds}`;
      return uniqueCode;
    }

    // مقداردهی اولیه EmailJS
    (function () {
      emailjs.init("BkksuBHwOzEXpKEoV");
    })();

    // ارسال فرم
    document.getElementById('contact-form').addEventListener('submit', function (event) {
  event.preventDefault(); // جلوگیری از ارسال فرم به روش قدیمی

  // تولید کد یکتا
  const uniqueCode = generateUniqueCode();

  // جمع‌آوری داده‌های فرم
  const templateParams = {
    id: uniqueCode, // اضافه کردن کد یکتا
    mobile: document.getElementById('mobile').value,
    firstName: document.getElementById('firstName').value,
    lastName: document.getElementById('lastName').value,
    company: document.getElementById('company').value,
    position: document.getElementById('position').value,
    phone: document.getElementById('phone').value,
    partName: document.getElementById('partName').value,
    partSerial: document.getElementById('partSerial').value,
    machineName: document.getElementById('machineName').value,
    machineSerial: document.getElementById('machineSerial').value,
    faultReason: document.getElementById('faultReason').value,
    faultStatus: document.getElementById('faultStatus').value,
    description: document.getElementById('description').value
  };

  // نمایش پنجره تأییدیه
  Swal.fire({
    title: 'آیا از ارسال فرم مطمئن هستید؟',
    text: `کد درخواست شما در مرحله بعد نمایش داده می‌شود و کلیه پیگیری‌ها توسط این کد انجام می‌شود!`,
    icon: 'question',
    showCancelButton: true,
    confirmButtonText: 'بله، ارسال کن',
    cancelButtonText: 'لغو'
  }).then((result) => {
    if (result.isConfirmed) {
      // ارسال ایمیل با EmailJS
      emailjs.send('service_lewjaik', 'template_cwar73x', templateParams, 'BkksuBHwOzEXpKEoV')
        .then(function (response) {
          console.log('SUCCESS!', response.status, response.text);
          Swal.fire({
            icon: 'success',
            title: 'موفقیت‌آمیز!',
            text: `پیام با موفقیت ارسال شد! کد درخواست شما: ${uniqueCode}`,
            confirmButtonText: 'باشه',
            timer: 20000, // نمایش پیام به مدت 3 ثانیه
            timerProgressBar: true // نمایش نوار پیشرفت تایمر
          }).then(() => {
            // هدایت به صفحه اصلی بعد از بسته شدن پیام
            window.location.href = '/'; // آدرس صفحه اصلی
          });
        }, function (error) {
          console.log('FAILED...', error);
          Swal.fire({
            icon: 'error',
            title: 'خطا!',
            text: 'ارسال پیام با مشکل مواجه شد: ' + error.text,
            confirmButtonText: 'باشه'
          });
        });
    }
  });
});
  </script>

  <script src="./load-footer.js"></script>
  <script src="./load-topbar.js"></script>
  <script src="./load-navbar.js"></script>
</body>
</html>
